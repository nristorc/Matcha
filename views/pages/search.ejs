<% if(!index) {%>
	<%- include('../partial/head')%>
	<%- include('../partial/header')%>

<!-- Search navbar -->

<nav class="navbar fixed-top search-nav">
		
	<!-- Sort -->
	
	<form action="/search" method="get">
		<div class="input-group mb-3">
				<div class="input-group-prepend">
					<label class="input-group-text" for="inputGroupSelect01">Trier par</label>
				</div>
				<select class="custom-select" name="sort" id="inputSort">
					<option selected></option>
					<option value="ageAsc">Age croissant</option>
					<option value="ageDesc">Age décroissant</option>
					<option value="loc">Localisation la plus proche</option>
					<option value="popAsc">Popularité croissant</option>
					<option value="popDesc">Popularité décroissant</option>
				</select>
				</div>
	</form>

		<!-- Filters -->



		<!-- <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="20" data-slider-step="1" data-slider-value="14"/> -->
		<!-- <script>
		$('#ex1').slider({
			formatter: function(value) {
				return 'Current value: ' + value;
			}
		});
		</script> -->

		<div class="accordion" id="accordionExample">
				<button class="btn btn-link forgot-password collapsed" type="button" data-toggle="collapse" data-target="#collapse" aria-expanded="false" aria-controls="collapse">
					Recherche avancée
				</button>
			</div>
			<div id="collapse" class="collapse" data-parent="#accordionExample">
					<div class="card-body">
						<form action="/search" method="get">

						</form>
						<!-- <form action="/search" method="get">
							<div class="form-group">
								<div class="display-register">
									<div class="form-group">
										<h5>Ré-initialisation de votre mot de passe</h5>
										<label for="checkEmail">Renseignez l'email associé à votre compte</label>
										<input type="email" class="form-control" id="checkEmail" name="checkEmail" placeholder="Entrez votre Email">
									</div>
								</div>
							</div>
						</form>
						 -->
					</div>
				</div>
	<!-- <p>
		<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
			Recherche avancée
		</button>
		

	</p>

	<div class="collapse" id="collapseExample">
		<div class="card card-body">
			Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. Nihil anim keffiyeh helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident.
		</div>
		</div> -->

</nav>


<%}%>

<!-- Results -->

<div class="scroll" id="scroll">
	<% var x = index;
	var i = 0;
	while (i < 6){ 
		if (i===0 || i===3){ %>
			<div class="row">
		<%}%>
		<div class="col-sm search-col">
			<% if (users[x]){%>
				<div class="img-pop">
					<div class="containerPic">
						<img src="<%=users[x]['profil']%>" title="<%=users[x]['username']%>" alt="<%=users[x]['username']%>" class="profile-pic search-pic">
					</div>
					<% if (users[x]['popularity'] >= 0){
						if (users[x]['popularity'] < 50){ %>
							<button type="button" class="btn btn-primary popularity-search-1"><%=users[x]['popularity']%>%</button>
						<% } else if (users[x]['popularity'] < 85) { %>
							<button type="button" class="btn btn-primary popularity-search-2"><%=users[x]['popularity']%>%</button>
						<% } else { %>
							<button type="button" class="btn btn-primary popularity-search-3"><%=users[x]['popularity']%>%</button>
						<%}
					} else {
						if (users[x]['popularity'] > -50){ %>
							<button type="button" class="btn btn-primary popularity-search-4"><%=users[x]['popularity']%>%</button>
						<% } else if (users[x]['popularity'] > -85) { %>
							<button type="button" class="btn btn-primary popularity-search-5"><%=users[x]['popularity']%>%</button>
						<% } else { %>
							<button type="button" class="btn btn-primary popularity-search-6"><%=users[x]['popularity']%>%</button>
						<%}
					}
			
					%>
					<i class="fas fa-heart matched" id="matched<%=users[x]['id']%>" title="c'est un match !" style="display:none"></i>
					<i class="fas fa-thumbs-up liked" id="liked<%=users[x]['id']%>" title="Ce membre vous a liké !" style="display:none"></i>
				</div>

				<span><i class="far fa-thumbs-up picto" id="oklikeSearch-<%=users[x]['id']%>" style="text-align: center;" onclick="like(this.id)">Like</i></span>
				<span><i class="fas fa-thumbs-up picto" id="unlikeSearch-<%=users[x]['id']%>" style="text-align: center; display: none;" onclick="unlike(this.id)">Unlike</i></span>

				<h5><%=users[x]['username']%></h5>
				<h6>
					<% if (users[x]['gender'] === null) { %>
						Genre non renseigne,
					<%} else { %>
						<%=users[x]['gender']%>,
					<% } %>
					<% if (users[x]['orientation'] === null) { %>
						orientation non renseignee
					<%} else { %>
						<%=users[x]['orientation']%>
					<% } %>
				</h6>
				<h6>
					<% if (users[x]['description'] == null) { %>
						Description manquante
					<%} else { %>
						<%=users[x]['description']%>
					<% } %>
				</h6>

<!-- Like and match check -->

			<% var a = 0;
			var like = 0;
			var liked = 0;
			while (likes[a]){
				if (users[x]['id'] === likes[a]['user_id']) {
					like = 1;
				}
				if (users[x]['id'] === likes[a]['user_liked']){
					liked = 1;
				}
				a++;
			}
			if (like === 1 && liked === 1){ %>
				<script>
					// getscript
					document.getElementById("matched<%=users[x]['id']%>").style.display = "flex";
					document.getElementById("oklikeSearch-<%=users[x]['id']%>").style.display = "none";
					document.getElementById("unlikeSearch-<%=users[x]['id']%>").style.display = "flex";
				</script>
			<% } else if (like === 1 && liked === 0){ %>
				<script>
					document.getElementById("liked<%=users[x]['id']%>").style.display = "flex";
				</script>
			<% } else if (liked === 1 && like === 0) { %>
				<script>
					document.getElementById("oklikeSearch-<%=users[x]['id']%>").style.display = "none";
					document.getElementById("unlikeSearch-<%=users[x]['id']%>").style.display = "flex";
				</script>
			<% }
		} %>
		</div>
		<% if (x===2 || x===5){ %>
			</div>
		<% }  
		x++;
		i++;
	}
%>

</div>


<!-- Loading animation -->

<% if (index == 0){ %>
	<p id="loading" style="display:none">
			<img style="width:40px; margin-left:50%" src="https://ubisafe.org/images/transparent-gif-loading-1.gif" alt="Loading…" />
	</p>

<!-- Scripts -->

<script src="./public/js/scroll.js"></script>
<script src="./public/js/like.js"></script>

<% } %>


<% include ../partial/footer.ejs%>